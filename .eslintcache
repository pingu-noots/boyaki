[{"/Users/h.takahashi/amplify-sns-workshop/boyaki/src/reportWebVitals.js":"1","/Users/h.takahashi/amplify-sns-workshop/boyaki/src/App.js":"2","/Users/h.takahashi/amplify-sns-workshop/boyaki/src/index.js":"3","/Users/h.takahashi/amplify-sns-workshop/boyaki/src/aws-exports.js":"4","/Users/h.takahashi/amplify-sns-workshop/boyaki/src/containers/AllPosts.js":"5","/Users/h.takahashi/amplify-sns-workshop/boyaki/src/containers/Sidebar.js":"6","/Users/h.takahashi/amplify-sns-workshop/boyaki/src/containers/PostsBySpecifiedUser.js":"7","/Users/h.takahashi/amplify-sns-workshop/boyaki/src/components/PostList.js":"8","/Users/h.takahashi/amplify-sns-workshop/boyaki/src/graphql/mutations.js":"9","/Users/h.takahashi/amplify-sns-workshop/boyaki/src/graphql/subscriptions.js":"10","/Users/h.takahashi/amplify-sns-workshop/boyaki/src/graphql/queries.js":"11","/Users/h.takahashi/amplify-sns-workshop/boyaki/src/containers/Timeline.js":"12","/Users/h.takahashi/amplify-sns-workshop/boyaki/src/containers/Search.js":"13"},{"size":362,"mtime":1610373483499,"results":"14","hashOfConfig":"15"},{"size":2819,"mtime":1612087368229,"results":"16","hashOfConfig":"15"},{"size":500,"mtime":1610373483497,"results":"17","hashOfConfig":"15"},{"size":692,"mtime":1612022408892,"results":"18","hashOfConfig":"15"},{"size":2198,"mtime":1610802867120,"results":"19","hashOfConfig":"15"},{"size":4596,"mtime":1612445704847,"results":"20","hashOfConfig":"15"},{"size":4168,"mtime":1611412472841,"results":"21","hashOfConfig":"15"},{"size":3790,"mtime":1613846941149,"results":"22","hashOfConfig":"15"},{"size":3622,"mtime":1611573022241,"results":"23","hashOfConfig":"15"},{"size":2440,"mtime":1611573022303,"results":"24","hashOfConfig":"15"},{"size":4406,"mtime":1611573022156,"results":"25","hashOfConfig":"15"},{"size":2617,"mtime":1611473738440,"results":"26","hashOfConfig":"15"},{"size":2677,"mtime":1612081765585,"results":"27","hashOfConfig":"15"},{"filePath":"28","messages":"29","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"30"},"11t8pfe",{"filePath":"31","messages":"32","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"33","messages":"34","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"35"},{"filePath":"36","messages":"37","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"38","messages":"39","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"40","messages":"41","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"42","messages":"43","errorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"44"},{"filePath":"45","messages":"46","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"47","messages":"48","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"49","messages":"50","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"51","messages":"52","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"53","messages":"54","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"55","messages":"56","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"/Users/h.takahashi/amplify-sns-workshop/boyaki/src/reportWebVitals.js",[],["57","58"],"/Users/h.takahashi/amplify-sns-workshop/boyaki/src/App.js",[],"/Users/h.takahashi/amplify-sns-workshop/boyaki/src/index.js",[],["59","60"],"/Users/h.takahashi/amplify-sns-workshop/boyaki/src/aws-exports.js",[],"/Users/h.takahashi/amplify-sns-workshop/boyaki/src/containers/AllPosts.js",[],"/Users/h.takahashi/amplify-sns-workshop/boyaki/src/containers/Sidebar.js",["61","62"],"/Users/h.takahashi/amplify-sns-workshop/boyaki/src/containers/PostsBySpecifiedUser.js",["63","64","65"],"import React, { useState, useEffect, useReducer } from 'react';\n\nimport API, { graphqlOperation } from '@aws-amplify/api';\nimport Auth from '@aws-amplify/auth';\nimport { useParams, useHistory } from 'react-router';\nimport { Box, Button} from '@material-ui/core';\n\nimport { listPostsBySpecificOwner, getFollowRelationship } from '../graphql/queries';\nimport { onCreatePost } from '../graphql/subscriptions';\nimport { createFollowRelationship, deleteFollowRelationship } from '../graphql/mutations';\nimport PostList from '../components/PostList';\nimport Sidebar from './Sidebar';\n\nconst SUBSCRIPTION = 'SUBSCRIPTION';\nconst INITIAL_QUERY = 'INITIAL_QUERY';\nconst ADDITIONAL_QUERY = 'ADDITIONAL_QUERY';\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case INITIAL_QUERY:\n      return action.posts;\n    case ADDITIONAL_QUERY:\n      return [...state, ...action.posts]\n    case SUBSCRIPTION:\n      return [action.post, ...state]\n    default:\n      return state;\n  }\n};\n\nexport default function PostsBySpecifiedUser() {\n  const { userId } = useParams();\n\n  const [posts, dispatch] = useReducer(reducer, []);\n  const [nextToken, setNextToken] = useState(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [currentUser, setCurrentUser] = useState(null);\n  const [isFollowing, setIsFollowing] = useState(false);\n\n  const getPosts = async (type, nextToken = null) => {\n    const res = await API.graphql(graphqlOperation(listPostsBySpecificOwner, {\n      owner: userId,\n      sortDirection: 'DESC',\n      limit: 20, //default = 10\n      nextToken: nextToken,\n    }));\n    console.log(res);\n    dispatch({ type: type, posts: res.data.listPostsBySpecificOwner.items })\n    setNextToken(res.data.listPostsBySpecificOwner.nextToken);\n    setIsLoading(false);\n  }\n\n  const getIsFollowing = async ({followerId, followeeId}) => {\n    const res = await API.graphql(graphqlOperation(getFollowRelationship,{\n      followeeId: followeeId,\n      followerId: followerId,\n    }));\n    console.log(res)\n    return res.data.getFollowRelationship !== null\n  }\n\n  const getAdditionalPosts = () => {\n    if (nextToken === null) return; //Reached the last page\n    getPosts(ADDITIONAL_QUERY, nextToken);\n  }\n\n  const follow = async () => {\n    console.log('follow')\n    const input = {\n      followeeId: userId,\n      followerId: currentUser.username,\n      timestamp: Date.now(),\n    }\n    const res = await API.graphql(graphqlOperation(createFollowRelationship, {input: input}));\n    if(!res.data.createFollowRelationship.erros) setIsFollowing(true);\n    console.log(res);\n  }\n\n  const unfollow = async() => {\n    console.log('unfollow');\n    const input = {\n      followeeId: userId,\n      followerId: currentUser.username,\n    }\n    const res = await API.graphql(graphqlOperation(deleteFollowRelationship,{input: input}));\n\n    if(!res.data.deleteFollowRelationship.erros) setIsFollowing(false);\n    console.log(res)\n  }\n\n  useEffect(() => {\n    const init = async() => {\n      const currentUser = await Auth.currentAuthenticatedUser();\n      setCurrentUser(currentUser);\n\n      setIsFollowing(await getIsFollowing({followeeId: userId, followerId: currentUser.username}));\n\n      getPosts(INITIAL_QUERY);\n    }\n    init()\n\n    const subscription = API.graphql(graphqlOperation(onCreatePost)).subscribe({\n      next: (msg) => {\n        const post = msg.value.data.onCreatePost;\n        if (post.owner !== userId) return;\n        dispatch({ type: SUBSCRIPTION, post: post });\n      }\n    });\n    return () => subscription.unsubscribe();\n  }, []);\n\n\n  return (\n    <React.Fragment>\n      <Sidebar\n        activeListItem='profile'\n      />\n      <PostList\n        isLoading={isLoading}\n        posts={posts}\n        getAdditionalPosts={getAdditionalPosts}\n        listHeaderTitle={userId}\n        listHeaderTitleButton={\n          ( currentUser && userId !== currentUser.username ) &&\n          ( isFollowing ?\n            <Button  variant='contained' color='primary' onClick={unfollow}>Following</Button>\n          :\n            <Button variant='outlined' color='primary' onClick={follow}>Follow</Button>\n          )\n        }\n      />\n    </React.Fragment>\n  )\n}\n","/Users/h.takahashi/amplify-sns-workshop/boyaki/src/components/PostList.js",[],"/Users/h.takahashi/amplify-sns-workshop/boyaki/src/graphql/mutations.js",[],"/Users/h.takahashi/amplify-sns-workshop/boyaki/src/graphql/subscriptions.js",[],"/Users/h.takahashi/amplify-sns-workshop/boyaki/src/graphql/queries.js",[],"/Users/h.takahashi/amplify-sns-workshop/boyaki/src/containers/Timeline.js",[],"/Users/h.takahashi/amplify-sns-workshop/boyaki/src/containers/Search.js",[],{"ruleId":"66","replacedBy":"67"},{"ruleId":"68","replacedBy":"69"},{"ruleId":"66","replacedBy":"70"},{"ruleId":"68","replacedBy":"71"},{"ruleId":"72","severity":1,"message":"73","line":14,"column":13,"nodeType":"74","messageId":"75","endLine":14,"endColumn":23},{"ruleId":"72","severity":1,"message":"76","line":16,"column":11,"nodeType":"74","messageId":"75","endLine":16,"endColumn":19},{"ruleId":"72","severity":1,"message":"77","line":5,"column":21,"nodeType":"74","messageId":"75","endLine":5,"endColumn":31},{"ruleId":"72","severity":1,"message":"78","line":6,"column":10,"nodeType":"74","messageId":"75","endLine":6,"endColumn":13},{"ruleId":"79","severity":1,"message":"80","line":110,"column":6,"nodeType":"81","endLine":110,"endColumn":8,"suggestions":"82"},"no-native-reassign",["83"],"no-negated-in-lhs",["84"],["83"],["84"],"no-unused-vars","'PersonIcon' is defined but never used.","Identifier","unusedVar","'HomeIcon' is defined but never used.","'useHistory' is defined but never used.","'Box' is defined but never used.","react-hooks/exhaustive-deps","React Hook useEffect has missing dependencies: 'getPosts' and 'userId'. Either include them or remove the dependency array.","ArrayExpression",["85"],"no-global-assign","no-unsafe-negation",{"desc":"86","fix":"87"},"Update the dependencies array to be: [getPosts, userId]",{"range":"88","text":"89"},[3547,3549],"[getPosts, userId]"]